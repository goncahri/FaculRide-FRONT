<section class="apoio-container">
  <h2 class="titulo-apoio">Seja um apoiador da ideia ðŸ’™</h2>

  <p class="texto-apoio">
    Sua doaÃ§Ã£o ajuda a manter o FaculRide vivo e em evoluÃ§Ã£o.
    Aqui nÃ£o Ã© compra de produto, Ã© apoio espontÃ¢neo ao projeto.
  </p>

  <form (ngSubmit)="iniciarDoacao()">
    <!-- Dados bÃ¡sicos do apoiador -->
    <div class="row mb-3">
      <div class="col-md-6 mb-2">
        <label class="form-label">Nome</label>
        <input
          type="text"
          class="form-control"
          [(ngModel)]="nome"
          name="nome"
          required
        />
      </div>
      <div class="col-md-6 mb-2">
        <label class="form-label">E-mail</label>
        <input
          type="email"
          class="form-control"
          [(ngModel)]="email"
          name="email"
          required
        />
      </div>
    </div>

    <!-- Planos rÃ¡pidos -->
    <div class="planos-apoio mb-3">
      <button
        *ngFor="let plano of planos"
        type="button"
        class="btn-plano"
        [class.selecionado]="valorSelecionado === plano.valor"
        (click)="selecionarPlano(plano)"
      >
        <div class="plano-label">{{ plano.label }}</div>
        <div class="plano-valor">
          R$ {{ plano.valor | number:'1.2-2' }}
        </div>
      </button>
    </div>

    <!-- Valor personalizado -->
    <div class="doacao-valor-custom mb-4">
      <label class="form-label">Ou escolha outro valor:</label>
      <div class="input-group">
        <span class="input-group-text">R$</span>
        <input
          type="number"
          min="1"
          class="form-control"
          [value]="valorSelecionado || ''"
          (input)="
            valorSelecionado = $any($event.target).valueAsNumber;
            tipoApoioSelecionado = 'Apoio Personalizado'
          "
        />
      </div>
    </div>

    <button
      class="btn btn-primary btn-apoio"
      type="submit"
      [disabled]="carregando"
    >
      <span *ngIf="!carregando">Apoiar com Mercado Pago</span>
      <span *ngIf="carregando">Gerando link de apoio...</span>
    </button>

    <small class="texto-termos">
      VocÃª serÃ¡ redirecionado ao ambiente seguro do Mercado Pago para concluir sua doaÃ§Ã£o.
    </small>
  </form>
</section>

<!-- ================= MODAL PIX ================= -->
<div class="modal-pix-backdrop" *ngIf="exibirModalPix">
  <div class="modal-pix-card">
    <button class="modal-fechar" type="button" (click)="fecharModalPix()">Ã—</button>

    <h3 class="modal-titulo">PIX gerado com sucesso ðŸŽ‰</h3>

    <p class="modal-subtitulo" *ngIf="statusPagamento">
      Status do pagamento: <strong>{{ statusPagamento }}</strong>
    </p>

    <!-- QR CODE -->
    <div class="modal-qr-wrapper" *ngIf="qrCodeBase64">
      <img
        [src]="'data:image/png;base64,' + qrCodeBase64"
        alt="QR Code PIX"
        class="qr-image"
      />
    </div>

    <!-- Copia e cola -->
    <div class="modal-copia-cola" *ngIf="qrCode">
      <label>CÃ³digo PIX (copia e cola):</label>
      <textarea
        readonly
        class="pix-textarea"
      >{{ qrCode }}</textarea>

      <button
        type="button"
        class="btn btn-secondary btn-copiar"
        (click)="copiarCodigoPix()"
      >
        {{ copiado ? 'Copiado! âœ…' : 'Copiar cÃ³digo PIX' }}
      </button>
    </div>

    <p class="modal-info-extra">
      Abra o app do seu banco, escolha pagar via PIX e use o QR Code
      ou o cÃ³digo de copia e cola acima.
    </p>
  </div>
</div>
